<html>
    <head>
        <style>
            body {
                background-color: white;
                margin: 20px;
                padding: 20px;
            }
            table, th, td {
                border-collapse: collapse;  
                border: 1px solid black;
            }
            td, th {
                padding: 20px;
                vertical-align: top;
            }
            td.qrtd {
                width: "1*";
                text-align: center;
            }
        </style>
        <!--
            Of course you know about jQuery http://jquery.com . jQuery is
            copyright (c) The jQuery Foundation and licensed under the terms of 
            the MIT licence. 
        -->
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
        <!--
            QR codes are generated using Shim Sangmin's "qrcode.js" library, 
            available at https://github.com/davidshimjs/qrcodejs . It is 
            copyright (c) Shim Sangmin (davidshimjs) and licensed under the 
            terms of the MIT licence.
        -->
		<script src="http://davidshimjs.github.io/qrcodejs/qrcode.min.js"></script>
		<script>
            var SURVEY_OPTION = <%= surveyOption %>;

            var addSurveyTask = function (oaAddress, callback) {

                var randomIdExists = Math.random().toString(36).substring(7),
                    randomIdWrong = Math.random().toString(36).substring(7),
                    randomIdDoesntexist = Math.random().toString(36).substring(7);
                $('#surveyTasksTable > tbody:last').after(
                    '<tr>' +
                        '<td>' + 
                            oaAddress.address.pao + ', ' +
                            (oaAddress.address.sao ? oaAddress.address.sao + ', ' : '') +
                            oaAddress.address.street.name.en[0] + '<br>' +
                            (oaAddress.address.locality.name.en[0] ? oaAddress.address.locality.name.en[0] + '<br>' : '') +
                            oaAddress.address.town.name.en[0] + '<br>' +
                            oaAddress.address.postcode.name +
                        '</td>' +
                        '<td class="qrtd"><div id="' + randomIdExists + '"></div><br>It\'s there, I can see it!</td>' + 
                        '<td class="qrtd"><div id="' + randomIdWrong + '"></div><br>It\'s there but something\'s wrong...</td>' + 
                        '<td class="qrtd"><div id="' + randomIdDoesntexist + '"></div><br>I can\'t find it.</td>' + 
                    '</tr>');
                [ { 'id': randomIdExists, 'api': 'exists'}, 
                  { 'id': randomIdWrong, 'api': 'wrong'},
                  { 'id': randomIdDoesntexist, 'api': 'doesntexist'} ].forEach(
                    function (params) {
                        new QRCode(document.getElementById(params.id), {
                            // TODO: the one below is just a random URL, waiting for Open 
                            // Addresses to specify a suitable API
                            'text': "http://someFictionalApi.openaddressesuk.org/" + params.api + "?address=" + encodeURIComponent(Math.random().toString(36).substring(7)),
                            'width': 100,
                            'height': 100,
                            'colorDark': "#000000",
                            'colorLight': "#ffffff",
                            'correctLevel': QRCode.CorrectLevel.H
                        });
                    });
            }

            function addSurveyOption (surveyOption) {
                surveyOption.inferredAddresses.forEach(function (oaAddress) {
                    addSurveyTask(oaAddress);
                });
            };

        </script>
    	</head>
    	<body>
    		<table id="surveyTasksTable">
    			<tbody>
    				<tr><th colspan="4"><font size="+2"><p>*** This is just a demo survey form. The addresses were inferred for real - so you could actually go and check on them - but the QR codes do not point to the Open Addresses systems yet, as they are not ready. ***</p></font></th></tr>
    				<tr><th colspan="4"><p>This 'addresses survey' form for Open Addresses UK (http://openaddressesuk.org) was made using <i>oa-runner</i>, by Digital Contraptions Imaginarium Ltd. Read more at http://dico.im/oa-runner .</p></th></tr>
    			</tbody>
    		</table>
    		<script>
                addSurveyOption(SURVEY_OPTION);
        	</script>
	   </body>
</html>